<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Tutorial: Building control sites</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Tutorial: Building control sites</h1>

    <section>

<header>
    

    <h2>Building control sites</h2>
</header>

<article>
    <p>This tutorial gives an overview of how one builds controls in a particular
database.</p>
<p><em>Control</em> components are built from documents of type <code>&quot;control&quot;</code> in the
database in question.  When one defines a <code>&quot;control&quot;</code> document and uploads it
into the database, it will automatically be included in the Controls site of a
database.  The typical way to define a control document is to create a <code>.json</code>
file in the <code>data</code> directory of the corresponding database (subsystem).</p>
<p>Let's have a look at an example control document:</p>
<pre class="prettyprint source lang-javascript"><code>{
  &quot;_id&quot; : &quot;measure&quot;,  // ID of document, must be unique
  &quot;type&quot; : &quot;control&quot;, // type, must be &quot;control&quot;
  &quot;title&quot; : &quot;Make single measurement&quot;, // Title
  &quot;description&quot; : &quot;Record single log file&quot;, // description, help.  Can also contain HTML
  &quot;html&quot; : &quot;...&quot;, // main html of control component
  &quot;script&quot; : &quot;...&quot; // main script
}</code></pre><p>The first 4 fields (<code>&quot;_id&quot;</code>, <code>&quot;type&quot;</code>, <code>&quot;title&quot;</code>, and <code>&quot;description&quot;</code>) are
self-explanatory, where the only point that should be made is that
<code>&quot;description&quot;</code> may, and <em>should</em>, include HTML.  This is an ideal location to
document to the user how your interface component works.  One may also define
other fields which may be used to pass information to the script run on the
page.  The content of the <code>&quot;description&quot;</code> field shows up inside a popup, which
may be accessed via an <em>Info</em> button on the page.</p>
<p>We will examine the other two fields in the following:</p>
<h3><code>&quot;html&quot;</code> and <code>&quot;script&quot;</code></h3><p>The <code>&quot;html&quot;</code> field provides the main HTML layout for the component.  Here you
should define as much HTML as possible, which is general everything that may be
statically defined.</p>
<p>The <code>&quot;script&quot;</code> field is also important, though optional.  It allows a user to
define code that will run when the page is loaded.  It is important to note
that this must contain a function defined like:</p>
<pre class="prettyprint source lang-javascript"><code>{

  &quot;script&quot; : &quot;
    function($theDiv, docobj) {
      // ... User code run that is run on page load
  }
&quot;
}</code></pre><p>where the first argument (in this case, <code>$theDiv</code>) is the <code>&lt;div&gt;</code> object in
which the component is inserted, and the second argument (in this case,
<code>docobj</code>) is the full JSON document from the database.  Having access to the
full JSON document allows one to save additional configuration information in
JSON format, which is especially useful for configuring devices.  Remember,
that you may define any extra information that is included here, as long as you
don't use the reserved field names listed above.</p>
<p>Let's look a little more closely at the function defined in <code>&quot;script&quot;</code>.</p>
<pre class="prettyprint source lang-javascript"><code>function($theDiv, docobj) {
  // n.b. console.log prints something in the browser developer debug window.
  // In this function we have a few &quot;global variables&quot; defined, in particular:
  console.log(nedm);  // The nedm variable is an nEDMDB object.
  console.log(theCurrentPage); // jQuery object referring to this current page.
}</code></pre><p>The <code>nedm</code> variable is an instantiation of the <a href="module-lib_nedm-nEDMDatabase.html">nEDMDatabase</a> class that
points to the current database.  For example, if one were on the Hg Laser page,
this would point by default to the database <code>&quot;nedm%2Fhg_laser&quot;</code>.  (Of course,
accessing other databases are possible, see the documentation for <a href="module-lib_nedm-nEDMDatabase.html#get_database">get_database</a>.) <code>theCurrentPage</code> is a
<a href="https://api.jquery.com/Types/#jQuery">jQuery object</a> that wraps the DOM
object of the page.</p>
<h3>Technical details</h3><p>This describes how the assembly of control documents actually works using
functionality from CouchDB.  For building your page, you generally don't need
to know this information.</p>
<p>Control pages take advantage of CouchDB <a href="http://docs.couchdb.org/en/latest/couchapp/ddocs.html#list-functions">list functions</a>, which take the results from a view and format it into an HTML page.
In this case, the view returns the list of control documents.</p>
<p>The list function loops through each control document and outputs the following
for each document:</p>
<pre class="prettyprint source lang-html"><code>&lt;div id='unique_name'>
  &lt;!-- content of doc.html -->
&lt;div>
&lt;script type='text/javascript'>&lt;!--
  (function() {
    var __base = require('lib/nedm');
    var nedm = new __base.nEDMDatabase('name_of_db'); // name_of_db automatically inserted by list function
    var theCurrentPage = $('#unique_name_of_page');
    theCurrentPage.on('pagecreate', function() {(
    // content of doc.script, should be of the form:
    // function($theDiv, doc) {
    //  ...
    // }
    )($('#unique_name') /* jQuery Object of div DOM */, doc /* content of doc */);
    }
  })();
//-->
&lt;/script></code></pre>
</article>

</section>

</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-lib_math.html">lib/math</a></li><li><a href="module-lib_monitoring_graph.html">lib/monitoring_graph</a></li><li><a href="module-lib_nedm.html">lib/nedm</a></li><li><a href="module-lib_update_db.html">lib/update_db</a></li></ul><h3>Externals</h3><ul><li><a href="external-DB.html">DB</a></li><li><a href="module-db.html">db</a></li><li><a href="module-dygraph-combined.html">dygraph-combined</a></li><li><a href="module-events.html">events</a></li><li><a href="module-jquery-mobile.html">jquery-mobile</a></li><li><a href="module-jquery-mobile-datebox.html">jquery-mobile-datebox</a></li><li><a href="module-js-cookie.html">js-cookie</a></li><li><a href="module-session.html">session</a></li><li><a href="module-toastr.html">toastr</a></li></ul><h3>Classes</h3><ul><li><a href="Dygraph.html">Dygraph</a></li><li><a href="module-lib_monitoring_graph.MonitoringGraph.html">MonitoringGraph</a></li><li><a href="module-lib_nedm-nEDMDatabase.html">nEDMDatabase</a></li><li><a href="module-lib_nedm-WebSocketListen.html">WebSocketListen</a></li><li><a href="nEDMDB.html">nEDMDB</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-admin.html">Common administration tasks</a></li><li><a href="tutorial-build_documentation.html">Build/Update Documentation</a></li><li><a href="tutorial-build_site.html">Building site components</a></li><li><a href="tutorial-couchdb.html">Database functionality (+ security)</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta3</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>